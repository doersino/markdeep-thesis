<meta charset="utf-8" lang="en">
<section class="titlepage">
    <div style="">
        <big>Eberhard Karls UniversitaÌˆt TuÌˆbingen</big><br>
        Mathematisch-Naturwissenschaftliche FakultaÌˆt<br>
        Wilhelm-Schickard-Institut fuÌˆr Informatik<br>
    </div>
    <div style="margin: 14em 0;">
        <big>Master's Thesis in Media Informatics</big>
        <br><br>
        <span style="font-family: var(--heading-font); font-weight: bold; font-size: 3rem;">UnicodeMath â¥… MathML</span>
        <br><br><br>
        <big>Noah Doersing</big>
        <br><br>
        *November 30, 2019*
    </div>
    <div style="font-size: 0.8em; font-family: var(--reference-font);">
        **Reviewers:**<br>
        Prof. Dr. Torsten Grust<br>
        Database Systems Research Group<br>
        Wilhelm-Schickard-Institut fuÌˆr Informatik<br>
        University of TuÌˆbingen
        <br>
        <br>
        Prof. Dr. TODO<br>
        TODO Research Group<br>
        Wilhelm-Schickard-Institut fuÌˆr Informatik<br>
        University of TuÌˆbingen
    </div>
</section>

---

(##) Abstract

test

(##) Notes

markdeep (morgan), bindery, fonts, unicodemath/murray, mathml, torsten, etc.

---

# Introduction

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

* a list of items
* more

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo.

> "Consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
> Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
> tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
> qu is nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
> consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
> cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
> proident, sunt in culpa qui officia deserunt mollit anim id est laborum."


cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

!!!
    I'm a note. Don't mind me, I'm just sitting here.

!!! note
    Another note.

!!! Tip
    Close the door on the way out.

!!! WARNING
    I'm a warning, perhaps. *Something might happen!*

!!! ERROR: Seriously
    Watch out, something **bad** could happen.

    This is still more error text.

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ C linenumbers
void insertion_sort(int data[], int length) {
    for (int i = 0; i < length; ++i) {
       ...
    }
}
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum. [#Kajiya86]

## testing this thing

test

### testing more

1. test
2. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
3. test

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in *volufptate* **velit** esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

```sql linenumbers
-- Combine possible_movements and the board_and_pieces to create the final result.
-- Result:
-- x : The x coordinate on the board.
-- y : The y coordinate on the board.
-- piece_id: Is either the id of a positioned piece or NULL, if no piece is on that square.
-- descr: The visual representation of a piece, 'O' or ' '. See board_and_pieces and possible_movements.  Type: CHAR(1).
board_result (x,y,piece_id,descr) AS (
  SELECT pb.x AS x, pb.y AS y,
         string_to_array(STRING_AGG(pb.piece_id, ','), ',') AS piece_id, -- List all ids without NULL (ARRAY_AGG would list with NULLs).
         MAX(pb.descr) AS descr -- Use MAX(...) because: ' ' < 'O' < any unicode chesspiece.
  FROM (
   TABLE possible_movements
     UNION
   TABLE board_and_pieces
  ) AS pb
  GROUP BY pb.y, pb.x
  ORDER BY pb.y DESC, pb.x
)
-- List in a chess board like fashion.
SELECT br.y AS " ", ARRAY_TO_STRING(ARRAY_AGG(br.descr ORDER BY br.x), '|') AS "A B C D E F G H "
  FROM board_result AS br
GROUP BY br.y
ORDER BY br.y DESC;
```

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse

Cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident.

Sunt in culpa qui officia deserunt mollit anim id est laborum.
Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis!

Aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur.

Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia.

Deserunt mollit anim id est laborum â€“ lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

# Overview

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

$E = mc^2$

Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ Lorem ipsum dolor $E = mc^2$ sit $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ $E = mc^2$ amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

**************************************************************************
*                    ____                      *                         *
*                   |    |_____.---.           |                         *
*                   o     _____|    )----------)-------.                 *
*                  / \   |     '---'           |     __|__               *
*                 /___\  |                     |     \   /               *
*                   |    '-------------.       |      \ /                *
* A ----------------'                  |       |       o                 *
*      .-------------------.     o-----)-------'       |                 *
*      |                   |___.---.   |               |___.---.         *
* B ---*---.__.---.         ___|    )--*--.__..---.     ____)   )----- Y *
*           __|    o----*--'   '---'    ______))   )---'   '---'         *
* C -------'  '---'     |              |     ''---'                      *
*                       |              o                                 *
*                       |             / \                     test       *
*                       |            /___\                               *
*                       |              |                                 *
*                       '--------------'                                 *
**************************************************************************

test

![Figure [robot]: A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot A picture of a robot ](https://images-na.ssl-images-amazon.com/images/I/61R2%2Bfcus9L._SY679_.jpg width="200")

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore Figure [robot] et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

testting [^test] testingg [^test]

test [^test2]

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum. [^test2]

# Vessels

ðƒ¢ðƒ¤ðƒ­ðƒ£ðƒ¯ðƒ°ðƒªðƒ¥ðƒ¦ðƒ¡ðƒ¨ðƒ©

## This is a very long headline lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo!

### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test
### test

## test

# test

## test

(#) Bibliography

[#Kajiya86]: James T. Kajiya. 1986. The Rendering Equation. In _Proceedings of Computer Graphics and Interactive Techniques (SIGGRAPH '86)_, ACM, 143-150. http://dx.doi.org/10.1145/15922.15902

---

<div style="width: 70%; margin: auto;">
(##) SelbstaÌˆndigkeitserklaÌˆrung

Hiermit versichere ich gemÃ¤ÃŸ Â§ 17 Absatz 4 des allgemeinen Teils der geltenden PrÃ¼fungsordnung, dass ich diese Arbeit selbstaÌˆndig verfasst, keine anderen als die angegebenen Hilfsmittel und Quellen benutzt habe, alle woÌˆrtlich oder sinngemaÌˆÃŸ aus anderen Werken uÌˆbernommenen Aussagen als solche gekennzeichnet habe und dass die Arbeit weder vollstaÌˆndig noch in wesentlichen Teilen Gegenstand eines anderen PrÃ¼fungsverfahrens gewesen ist sowie dass ich die Arbeit weder vollstaÌˆndig noch in wesentlichen Teilen bereits veroÌˆffentlicht habe und dass das in Dateiform eingereichte Exemplar mit den eingereichten gebundenen Exemplaren uÌˆbereinstimmt.

<br><br>
<div style="width: 80%; border-bottom: 0.1em solid black; margin-bottom: 0.4em;"></div>
<span style="font-family: var(--reference-font)">Datum, Ort, Unterschrift</span>

</div>



[^test]: Testing endnote

[^test2]: Lorem ipsum *dolor* sit amet, consectetur adipisicing elit, sed do eiusmod
tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

<!-- MathJax stuff TODO revisit this! need to load mathjax dynamically once markdeep is done, then manually trigger typeset?, then invoke bindery once mathjax sends the "End" signal? -->
<!--<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        jax: ["input/TeX","output/SVG"],
        TeX: {
            equationNumbers: {autoNumber: "AMS"},
            extensions: ["color.js"]
        },
        SVG: {
            font: "TeX"
        }
    });
</script>
<script src="lib/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_SVG"></script>-->

<!-- Stylesheets and scroll position restoring -->
<link rel="stylesheet" href="reset.css">
<link rel="stylesheet" href="style.css">

<script>
    // restore scroll position after page reload
    // (via torsten's slides)
    window.onbeforeunload = function() {
        window.name = window.pageYOffset;
    };
    window.onload = function() {
        setTimeout(function() {
            if (window.name.search("^\\d+$") == 0) {
                window.scrollTo(0, window.name);
            }
        }, 1000);
    }
</script>

<!-- Bindery stuff -->
<script src="lib/bindery/2.2.7/bindery.min.js"></script>
<script>
    function loadBindery() {
        Bindery.makeBook({
            content: '.md',
            pageSetup: {
                size: { width: '21cm', height: '29.7cm' },
                margin: { top: '2cm', inner: '3cm', outer: '2cm', bottom: '2cm' },
            },
            printSetup: {
                layout: Bindery.Layout.PAGES,
                paper: Bindery.Paper.AUTO,
                marks: Bindery.Marks.NONE,
                bleed: '0pt',
            },
            //view: Bindery.View.PREVIEW,
            view: Bindery.View.PRINT,
            rules: [
                Bindery.PageBreak({ selector: 'h1', position: 'before', continue: 'right' }),
                Bindery.PageBreak({ selector: '.nonumberh1', position: 'before', continue: 'right' }),
                Bindery.PageBreak({ selector: 'hr', position: 'before', continue: 'right' }),
                //Bindery.FullBleedSpread({ selector: '.big-figure' }),
                Bindery.RunningHeader({
                    render: function (page) {
                        if (page.number-2 <= 0) {
                            return "";
                        }
                        if (page.isLeft) {
                            if (page.heading.h1 != null) {
                                return `${page.number-2}â¸º${page.heading.h1}`
                            }
                            return `${page.number-2}`
                        } else {
                            return `Noah Doersingâ¸º${page.number-2}`;
                        }
                    }
                }),
                Bindery.Footnote({
                    selector: 'a.footnote-reference',
                    render: function (element, number) {
                        return "<sup>" + number + "</sup>" + window.atob(element.getAttribute("data-footnote-content"));
                    }
                }),
                Bindery.PageReference({  // TODO
                    selector: '.longTOC a',
                    /*replace: (element, number) => {
                        var t = element.getAttribute("data-headline-anchor");
                        console.log(element.parentNode);
                        //console.log(element);
                        //console.log(number);
                        return element;
                    },*/
                    replace: (element, number) => {
                        console.log(element);
                        console.log(number);

                        element.innerHTML += `<span class='num'>${number-2}</span>`;  /* TODO insert span later? */
                        return element;
                    },
                    createTest: function (element) {
                        const href = element.getAttribute('href');
                        if (!href) return null;
                        return el => el.querySelector("a.target.heading-target[name='" + href.substr(1) + "']");
                    }
                    //createTest: (element) => (element) => true
                })
            ],
        });
    }
</script>

<!-- Markdeep stuff -->
<script>
    // collect endnotes, write as data attributes into the references to them
    function processEndnotes() {

        // find all references to end notes
        var references = Array.from(document.querySelectorAll("sup > a[href^='#endnote-']"));
        var endnotes = [];
        references.forEach(function (element) {

            // get endnote
            var endnoteName = element.getAttribute("href").substr(1);
            var endnote = document.querySelector("a[name=\"" + endnoteName + "\"]").parentNode;

            // store for later removal
            if (!endnotes.includes(endnote)) {
                endnotes.push(endnote);
            }

            // remove the unneeded reference number
            endnote = endnote.cloneNode(true);
            //endnote.childNodes[0].remove();
            endnote.childNodes[1].remove();

            // base64-endcode
            var endnoteEncoded = window.btoa(endnote.innerHTML);
            element.setAttribute("data-footnote-content", endnoteEncoded);

            // prepare endnote reference for later processing in bindery
            element.classList.add("footnote-reference");
            element.innerHTML = "";
            element.parentNode.parentNode.replaceChild(element, element.parentNode);
        });

        // remove endnotes
        endnotes.forEach(function(element) {
            element.parentNode.removeChild(element);
            // TODO element.remove();?
        });
    }

    // coerce the table of contents into a format more suitable for filling in page numbers
    function processTOC() {
        var toc = document.getElementsByClassName("longTOC")[0].childNodes[1];
        var tocEntries = [];
        toc.childNodes.forEach(function (element) {

            // ignore <br>s and (Top) link
            if (element.tagName && element.tagName.toLowerCase() == "a" && !element.classList.contains("tocTop")) {
                tocEntries.push(element);
            }
        });

        newTocEntries = document.createElement("ul");
        tocEntries.forEach(function (element) {  // TODO refactor
            var row = document.createElement("li");
            //row.setAttribute("data-headline-anchor", element.getAttribute("href").substr(1));
            var col1 = document.createElement("span");
            var tocN = element.querySelector("span").innerHTML;
            tocN = "toc" + tocN.split("&nbsp;")[0];
            //console.log(document.querySelector("a[name='" + tocN + "']"));  // sanity check
            element.setAttribute("href", "#" + tocN);
            col1.appendChild(element);
            row.appendChild(col1);
            /*var col2 = document.createElement("span");
            col2.innerHTML = "?";
            row.appendChild(col2);*/
            newTocEntries.appendChild(row);
        });

        toc.parentNode.replaceChild(newTocEntries, toc);

        // each heading the text has three anchors in front of it, of the format
        // name, supersectionname/.../name, and tocN.N. the toc links to the
        // middle one, so pull this into a data attribute of the heading. (since
        // the anchors frequently end up on the page before the heading after
        // bindery is done processing)
        var headings = document.querySelectorAll(".md h1, .md h2, .md h3");
        headings.forEach(function (element) {
            //var anchor = element.previousSibling.previousSibling.getAttribute("name");
            //element.setAttribute("data-headline-anchor", anchor);
            /*var anchor = element.previousSibling.getAttribute("name");
            element.setAttribute("id", anchor);*/
            var anchor = element.previousSibling;
            anchor = anchor.cloneNode(true);
            anchor.classList.add("heading-target");
            element.appendChild(anchor);
        });
        //document.querySelectorAll("a.target").forEach(e => e.remove());
    }

</script>

<script>
    markdeepOptions = {
        tocStyle: 'long',
        detectMath: false,
        onLoad: function() {
            processEndnotes();
            processTOC();

            loadBindery();
            /*setTimeout(function() {
                MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
            }, 1000);*/
        }
    };
</script>
<script src="lib/markdeep/1.06/markdeep.min.js" charset="utf-8"></script>
